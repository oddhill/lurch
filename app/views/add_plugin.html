<h1>Add plugin</h1>
<form id="add-plugin">
  <input name="path" type="file" nwdirectory />
  <input name="add" type="submit" />
</form>

<script>
  $(document).ready(function() {
    var gui = require('nw.gui');
    var Datastore = require('nedb');
    var plugins = require('./plugins.js');
    var mv = require('mv');

    var db = new Datastore({
      filename : gui.App.dataPath + '/plugins.db',
      autoload: true
    });

    $('#add-plugin').submit(function(event) {
      event.preventDefault();

      var pluginPath = $(this).find('input[name="path"]').val();
      var pluginInfo = pluginPath + '/package.json';
      var pluginName = require(pluginInfo).name;

      var folderName = pluginPath.match(/([^\/]*)\/*$/)[1];
      var dest = gui.App.dataPath + '/plugins' + '/' + folderName;

      db.insert({
        name: pluginName,
        path: dest
      }, function(error, newDoc) {
        if (!error) {
          plugins.buildMenu(newDoc);
          mv(pluginPath, dest, function(err) {
            console.log(err);
          });
        }
      });
    });
  });
</script>
