<h1>Add plugin</h1>
<form id="add-plugin">
  <input name="path" type="file" nwdirectory />
  <input name="add" type="submit" />
</form>

<script>
  $(document).ready(function() {
    var gui = require('nw.gui');
    var plugins = require('./lib/plugins.js');
    var mainMenu = require('./lib/menu.js');
    var mv = require('mv');

    $('#add-plugin').submit(function(event) {
      event.preventDefault();

      var pluginPath = $(this).find('input[name="path"]').val();
      var pluginInfo = pluginPath + '/package.json';
      var pluginName = require(pluginInfo).name;

      var folderName = pluginPath.match(/([^\/]*)\/*$/)[1];
      var dest = gui.App.dataPath + '/plugins' + '/' + folderName;

      plugins.add(pluginName, pluginPath, dest, function(newDoc) {
        // Rebuild menu
        mainMenu.destroy(function() {
          mainMenu.populate();
          plugins.buildMostUsedMenu();
          plugins.rebuildMenu();
        });
        $('#app').load('views/manage_plugins.html');
      });
    });
  });
</script>
